<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecuy</title>
    <link rel="stylesheet" href="/css/modules.css">
    <link rel="shortcut icon" href="/img/ecuy180.png" type="image/x-icon">
</head>

<body>
    <div class="container">

        <nav class="top-nav">
            <button class="menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="user-avatar" id="profileDropdown">
                <img src="/img/perfil.PNG" alt="Avatar de usuario">
                <div class="dropdown-menu">
                    <a href="/perfil" class="dropdown-item">
                        <i class="profile-icon"></i> Ver perfil
                    </a>
                    <a href="#" class="dropdown-item"
                        onclick="document.getElementById('logoutForm').submit(); return false;">
                        <i class="logout-icon"></i> Cerrar sesión
                    </a>

                    <form id="logoutForm" th:action="@{/}" method="post" style="display:none;"></form>

                </div>
            </div>
        </nav>


        <div class="modules-container" id="modulesContainer">
        </div>
        
        <script th:inline="javascript">
            window.modulesData = /*[[${modulesJsonString}]]*/ [];
            
            console.log("Tipo de modulesData:", typeof window.modulesData);
            console.log("Datos de módulos cargados (crudo):", window.modulesData);
            
            if (typeof window.modulesData === 'string') {
                try {
                    window.modulesData = JSON.parse(window.modulesData);
                    console.log("Datos de módulos parseados:", window.modulesData);
                } catch (e) {
                    console.error("Error al parsear JSON:", e);
                    window.modulesData = [];
                }
            }
            
            if (!Array.isArray(window.modulesData)) {
                console.error("modulesData no es un array:", window.modulesData);
                window.modulesData = [];
            }
            
            console.log("Módulos listos para usar:", window.modulesData);
        </script>
        
        <div class="pagination" id="pagination" style="display: none;">
            <button id="prevPage" class="pagination-btn">Anterior</button>
            <span id="pageInfo">Página 1</span>
            <button id="nextPage" class="pagination-btn">Siguiente</button>
        </div>
    </div>

    <script th:src="@{/js/modules.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const profileDropdown = document.getElementById('profileDropdown');
            const dropdownMenu = document.querySelector('.dropdown-menu');
            const cerrarSesionBtn = document.getElementById('cerrarSesion');
            

            function cerrarSesion() {

                localStorage.removeItem('usuario');
                localStorage.removeItem('token');
                localStorage.removeItem('sesionIniciada');


                sessionStorage.clear();


                document.cookie.split(';').forEach(function (c) {
                    document.cookie = c.trim().split('=')[0] + '=;' + 'expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';
                });


                window.location.href = 'login.html';
            }


            if (cerrarSesionBtn) {
                cerrarSesionBtn.addEventListener('click', cerrarSesion);
            }


            profileDropdown.addEventListener('click', function (e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('active');
            });


            document.addEventListener('click', function () {
                dropdownMenu.classList.remove('active');
            });


            dropdownMenu.addEventListener('click', function (e) {
                e.stopPropagation();
            });
        });
    </script>
</body>

</html>